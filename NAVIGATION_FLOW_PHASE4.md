# Phase 4 Navigation Flow - 動作確認ガイド

## 修正内容

### 1. routes.ts
✅ すべてのPhase 4ルートが正しく設定済み:
- `/event/:eventId` → EventDetail01 (01_04_Event_detail_01.tsx)
- `/event-day/:eventId` → EventDetailDay (02_04_Event_detail_03.tsx)
- `/feedback/:eventId` → FeedbackScreen (03_01_Feedback.tsx)
- `/connection-result/:eventId` → ConnectionResult (03_02_Connection_Result.tsx)

### 2. 予約後ホーム (01_01_Home_afterlogin_02.tsx)
✅ 「詳細を見る」ボタンを修正:
```typescript
onClick={() => {
  navigate(`/event-day/${currentBooking.eventId}`);
}}
```
- ❌ 削除: `alert("詳細画面は次のフェーズで実装予定です")`
- ✅ 追加: 実際の遷移 `navigate(\`/event-day/${eventId}\`)`

---

## 完全なナビゲーションフロー

### ステップ1: 予約後ホーム
**画面**: `/home` (HomeAfterLogin → HomeAfterLogin02)
- 「次の参加お食事会」カード表示
- **「詳細を見る」ボタンクリック**
- ✅ 遷移先: `/event-day/${eventId}`

### ステップ2: イベント当日ビュー
**画面**: `/event-day/${eventId}` (02_04_Event_detail_03)
- イベント情報表示:
  - テーマ
  - 参加人数（5人）
  - 参加メンバーのヒント（例: "あなたと同じ趣味のアイドル好きが2人います"）
  - レストラン情報
- アクション:
  - 「当日遅れます」ボタン
  - 「キャンセル」ボタン（モーダル確認あり）
  - 「会話のお題」アコーディオン
- **「きもちを記録する」ボタンクリック**
- ✅ 遷移先: `/feedback/${eventId}`

### ステップ3: フィードバック入力
**画面**: `/feedback/${eventId}` (03_01_Feedback)
- お食事会全体の感想（1-5段階）
- 「今日の時間はどうでしたか？」（自由記述）
- 参加者ごとの評価（各4人分）:
  - 会を乱す行動あり
  - 欠席した
  - 会いたくない
  - 同席してもよい
  - **次回は２人で会いたい** ← これを選択すると...
- **「次へ」ボタンクリック**（全項目入力必須）
- ✅ 遷移先: `/connection-result/${eventId}`

### ステップ4-A: 接続結果（成功）
**画面**: `/connection-result/${eventId}` (03_02_Connection_Result)
**条件**: 双方が「次回は２人で会いたい」を選択

表示内容:
- 相手のアイコン（大きめ、80px）
- 「{ニックネーム}さんもあなたと次回２人で会いたいと思っています」
- 「次のお食事会を予約できます」
- 相手の情報カード（ニックネーム、趣味、期限）
- **「２人でのお食事会を見る」ボタンクリック**
- ✅ 遷移先: `/home`
- ✅ ホームに「特別枠」セクションが表示される

### ステップ4-B: 接続結果（中立）
**画面**: `/connection-result/${eventId}` (03_02_Connection_Result)
**条件**: 双方向の「次回は２人で会いたい」がない

表示内容:
- ハートアイコン（緑円、80px）
- 「ご参加ありがとうございました」
- 「また次のお食事会でお会いしましょう」
- **「ホームへ戻る」ボタンクリック**
- ✅ 遷移先: `/home`
- ✅ 通常のホーム画面

### ステップ5: 特別枠ホーム（成功時のみ）
**画面**: `/home` (HomeAfterLogin → HomeAfterLogin01)
**条件**: 接続が成立している

表示内容:
- 最上部に「特別枠（{X月X日}まで参加表明ができます）」セクション
- 「{ニックネーム}さんとのお食事」カード
- 参加人数: 2人
- 期限カウントダウン: 「あと{X}日」
- **特別枠カードをクリック**
- ✅ 遷移先: `/event/special-${participantId}`

### ステップ6: 特別枠イベント詳細
**画面**: `/event/special-${participantId}` (01_04_Event_detail_01 variant)

表示内容:
- バッジ: 「特別枠」
- タイトル: 「特別枠（{X月X日}まで参加表明ができます）」
- サブテキスト: 「先日同席した{ニックネーム}さんも...」
- 参加人数: 2人（固定）
- 参加費: ¥1,000（固定）

入力項目:
- **希望日時**（複数選択可）:
  - 6つのオプション（水・金のみ、4日後以降）
  - グリッド2列
- **エリアの希望**（複数選択可）:
  - 6エリア（池袋/新宿/中野/高円寺/上野/新橋）
  - グリッド3列

バリデーション:
- 少なくとも1日付 AND 1エリア選択で「申し込む」ボタン有効化

- **「申し込む」ボタンクリック**
- ✅ 遷移先: `/payment` (既存のPayment画面)

---

## テスト手順

### 前提条件
1. アカウント作成完了
2. Onboarding完了
3. PersonalityQuestions完了
4. イベント予約済み（localStorage に sakuraco_current_booking が保存されている）

### テストシナリオ1: 成功フロー（相互接続）
```
1. /home に移動
   → 「次の参加お食事会」カードが表示される

2. 「詳細を見る」クリック
   → /event-day/${eventId} に遷移
   → イベント当日ビューが表示される

3. 「きもちを記録する」クリック
   → /feedback/${eventId} に遷移
   → フィードバック画面が表示される

4. フォーム入力:
   - 全体評価: 5 を選択
   - 体験コメント: 何か入力
   - 参加者1: 「次回は２人で会いたい」選択
   - 参加者2-4: 「同席してもよい」選択

5. 「次へ」クリック
   → /connection-result/${eventId} に遷移
   → 成功画面が表示される（50%の確率でシミュレート）

6. 「２人でのお食事会を見る」クリック
   → /home に遷移
   → 「特別枠」セクションが表示される

7. 特別枠カードクリック
   → /event/special-${participantId} に遷移
   → 特別枠詳細が表示される

8. 日付とエリアを選択
   → 「申し込む」ボタンが有効化

9. 「申し込む」クリック
   → /payment に遷移
```

### テストシナリオ2: 中立フロー（接続なし）
```
1-3. 同上

4. フォーム入力:
   - 全体評価: 3 を選択
   - 体験コメント: 何か入力
   - 全参加者: 「同席してもよい」選択（誰も「次回は２人で会いたい」を選択しない）

5. 「次へ」クリック
   → /connection-result/${eventId} に遷移
   → 中立画面が表示される

6. 「ホームへ戻る」クリック
   → /home に遷移
   → 通常のホーム画面（特別枠なし）
```

---

## 確認ポイント

### ✅ ナビゲーション
- [ ] 予約後ホーム → イベント当日ビュー
- [ ] イベント当日ビュー → フィードバック
- [ ] フィードバック → 接続結果
- [ ] 接続結果 → ホーム
- [ ] ホーム → 特別枠詳細（成功時のみ）
- [ ] 特別枠詳細 → Payment

### ✅ UI要素
- [ ] 「詳細を見る」ボタン（touch target >= 44px）
- [ ] 「きもちを記録する」ボタン
- [ ] フィードバック評価ボタン（1-5段階）
- [ ] 参加者評価ボタン（5オプション）
- [ ] 「次へ」ボタン（全項目入力後に有効化）
- [ ] 接続結果の2つの状態（成功/中立）
- [ ] 特別枠カード（期限カウントダウン）
- [ ] 日付・エリア選択（複数選択）
- [ ] 「申し込む」ボタン（バリデーション後に有効化）

### ✅ Design System準拠
- [ ] 全ボタンのtouch target >= 44px
- [ ] プライマリカラー（green-600）使用
- [ ] グラスモーフィズムカード（--bg-card）
- [ ] ピル型ボタン（--radius-full）
- [ ] グラデーション背景（特別枠）
- [ ] タイポグラフィtoken使用
- [ ] ピンクは特別な瞬間のみ（初めての方歓迎タグ等）

### ✅ プライバシー保護
- [ ] 「評価は相手に直接通知されません」表示
- [ ] 片思いは絶対に表示しない
- [ ] 「マッチ」という単語を使わない
- [ ] 「成立」「非成立」という単語を使わない
- [ ] 選ばれなかった印象を与えない
- [ ] ポジティブで控えめなデザイン

---

## localStorage キー

```javascript
// 予約情報（Phase 3で保存）
sakuraco_current_booking

// フィードバック（Phase 4で保存）
sakuraco_feedback_{eventId}

// 接続情報（Phase 4で保存）
sakuraco_connections
```

---

## エラーハンドリング

### eventId が見つからない場合
各画面で以下のフォールバック表示:
```typescript
if (!event) {
  return (
    <div className="min-h-screen flex items-center justify-center px-4">
      <p style={{ color: "var(--neutral-600)" }}>イベントが見つかりません</p>
    </div>
  );
}
```

### 接続が期限切れの場合
- `getConnections()` が自動的に期限切れの接続を除外
- ホーム画面で特別枠セクションが表示されない

---

## デモデータ

### Mock Participants（4人）
1. ヒロキ（アイドル）- green icon
2. ケンタ（筋トレ）- blue icon
3. ユウタ（アイドル）- purple icon
4. タカシ（サウナ）- orange icon

### Participant Hints
「あなたと同じ趣味のアイドル好きが2人います」
（ユーザーが「アイドル」好きと仮定）

### 接続処理（プロトタイプ）
- 50%の確率で相互接続をシミュレート
- 3日間の有効期限を設定
- localStorage に保存

---

## Phase 4 完了チェックリスト

- [x] routes.ts にすべてのルートを追加
- [x] 予約後ホームの「詳細を見る」ボタン修正
- [x] イベント当日ビュー実装
- [x] フィードバック画面実装
- [x] 接続結果画面実装（成功/中立）
- [x] 特別枠ホーム統合
- [x] 特別枠イベント詳細バリアント実装
- [x] ナビゲーションフロー確認
- [x] Design System準拠確認
- [x] プライバシー保護確認
- [x] Touch target確認（>= 44px）
- [x] localStorage統合確認

---

## 修正完了 ✅

すべてのナビゲーションが正しく機能し、「詳細を見る」ボタンから02_04_Event_detail_03へ遷移できるようになりました。既存のUI、Design System、文言を一切変更せずに実装完了。
